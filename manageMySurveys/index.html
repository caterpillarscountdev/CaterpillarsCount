<html>
	<head>
		<!-- Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113319025-1"></script>
		<script>
  			window.dataLayer = window.dataLayer || [];
  			function gtag(){dataLayer.push(arguments);}
  			gtag('js', new Date());
			gtag('config', 'UA-113319025-1');
		</script>
		<!-- End of Google Analytics -->

		<title>Manage My Surveys | Caterpillars Count!</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Fanwood+Text:400i" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">
		<link href="../css/template.css" rel="stylesheet">
		<script src="../js/template.js?v=1"></script>
		<style>
			#surveys .survey{
				margin:20px 0px;
				font-family: 'Roboto Slab', serif;
				border-radius:5px;
				overflow:hidden;
				background:rgba(0,0,0,0.05);
			}
			
			#surveys .survey .headInfo{
				background:#333;
				color:#fff;
			}
			
			#surveys .survey .headInfo>div{
				padding:10px;
				display:inline-block;
			}
			
			#surveys .survey .headInfo>div:first-of-type{
				background:rgba(255,255,255,0.2);
			}
			
			#surveys .survey .siteInfo{
				padding:10px;
				color:#fff;
			}
			
			#surveys .survey .surveyInfo{
				padding:10px;
				color:#555;
			}
			
			#surveys .survey .arthropodSightingsInfo{
				max-height:0px;
				overflow:hidden;
				color:#999;
			}
			
			#surveys .survey .arthropodSightingsInfo .arthropodSighting{
				border-top:1px solid rgba(0,0,0,0.05);
				padding:10px;
				display:table;
			}
			#surveys .survey .arthropodSightingsInfo .arthropodSighting>div{
				display:table-cell;
				vertical-align:middle;
			}
			
			#surveys .survey .arthropodSightingsInfo .arthropodSighting>div:nth-of-type(2){
				padding-left:10px;
			}
			
			#surveys .survey .arthropodSightingsInfo .arthropodSighting .arthropodImage{
				width:60px;
				height:60px;
				background-position:center;
				background-size:contain;
				background-repeat:no-repeat;
			}
			
			#surveys .survey .arthropodSightingsDropdownButtonDiv{
				padding:10px;
				border-top:1px solid rgba(0,0,0,0.05);
				color:#bbb;
				text-align:center;
				cursor:pointer;
			}
		</style>
		<script>
			$(document).ready(function(){
				loadBackgroundImage($("#splashImage"), "../images/splash.png");
				
				loadPage(1);
			});
			
			function singular(word){
				if(word[word.length - 1] == "s"){
					return word.substring(0, (word.length - 1));
				}
				return word;
			}
			
			function plural(word){
				if(word[word.length - 1] == "s"){
					return word;
				}
				return word + "s";
			}
			
			var surveys = [];
			function loadPage(pageNumber){
				$.get("../php/getMySurveys.php?email=" + encodeURIComponent(window.localStorage.getItem("email")) + "&salt=" + window.localStorage.getItem("salt") + "&page=" + pageNumber, function(data){
					//success
					if(data.indexOf("true|") == 0){
						var herbivoryScores = ["None", "Trace (1-5%)", "Light (6-10%)", "Moderate (11-25%)", "Heavy (> 25%)"]
						surveys = JSON.parse(data.replace("true|", ""));
						var htmlToAdd = "";
						for(var i = 0; i < surveys.length; i++){
							htmlToAdd += "<div class=\"survey\">";
							htmlToAdd += 	"<div class=\"headInfo\">";
							htmlToAdd +=		"<div>" + surveys[i]["localDate"] + " " + surveys[i]["localTime"] + "</div>";
							htmlToAdd +=		"<div><a href=\"mailto:" + surveys[i]["observerEmail"] + "\">" + surveys[i]["observerFullName"] + "</a></div>";
							htmlToAdd +=	"</div>"
							htmlToAdd += 	"<div class=\"siteInfo\" style=\"background:" + surveys[i]["color"] + ";\"><span style=\"font-weight:bold;\">" + surveys[i]["plantCode"] + "</span>: <a href=\"https://www.google.com/maps/search/?api=1&query=" + surveys[i]["siteCoordinates"] + "\" target=\"_blank\">" + surveys[i]["siteName"] + " (" + surveys[i]["siteRegion"] + ")</a>, Circle " + surveys[i]["circle"] + ", " + surveys[i]["plantSpecies"] + "</div>";
							htmlToAdd += 	"<div class=\"surveyInfo\">";
							htmlToAdd += 		"<div>Observation method: " + surveys[i]["observaionMethod"] + "</div>";
							if(surveys[i]["notes"].trim().length > 0){
								htmlToAdd += 	"<div>Notes: " + surveys[i]["notes"] + "</div>";
							}
							htmlToAdd += 		"<div>Wet leaves: " + surveys[i]["wetLeaves"] + "</div>";
							htmlToAdd += 		"<div>Number of leaves: " + surveys[i]["numberOfLeaves"] + "</div>";
							htmlToAdd += 		"<div>Average leaf length: " + surveys[i]["averageLeafLength"] + "cm</div>";
							htmlToAdd += 		"<div>Herbivory score: " + herbivoryScores[surveys[i]["herbivoryScore"]] + "</div>";
							htmlToAdd +=	"</div>";
							htmlToAdd += 	"<div class=\"arthropodSightingsInfo\">";
							surveys[i]["arthropodSightings"].sort(function(a, b){
								if(a["group"].toLowerCase() < b["group"].toLowerCase()){return -1;}
								if(a["group"].toLowerCase() > b["group"].toLowerCase()){return 1;}
								return 0;
							})
							for(var j = 0; j < surveys[i]["arthropodSightings"].length; j++){
								htmlToAdd +=	"<div class=\"arthropodSighting\">";
								htmlToAdd +=		"<div>";
								htmlToAdd +=			"<div class=\"arthropodImage\" style=\"background-image:url('../images/selectIcons/orders/" + surveys[i]["arthropodSightings"][j]["group"] + ".png');\"></div>";
								htmlToAdd +=		"</div>";
								htmlToAdd +=		"<div>";
								if(surveys[i]["arthropodSightings"][j]["quantity"] == 1){
									htmlToAdd +=		"<div>" + surveys[i]["arthropodSightings"][j]["quantity"] + " " + surveys[i]["arthropodSightings"][j]["length"] + "mm " + singular(surveys[i]["arthropodSightings"][j]["group"]) + "</div>";
								}
								else{
									htmlToAdd +=		"<div>" + surveys[i]["arthropodSightings"][j]["quantity"] + " " + surveys[i]["arthropodSightings"][j]["length"] + "mm " + plural(surveys[i]["arthropodSightings"][j]["group"]) + "</div>";
								}
								if(surveys[i]["arthropodSightings"][j]["group"] == "caterpillar"){
								   	htmlToAdd +=		"<div>Hairy/spiny: " + surveys[i]["arthropodSightings"][j]["hairy"] + "</div>";
								   	htmlToAdd +=		"<div>In a leaf roll: " + surveys[i]["arthropodSightings"][j]["rolled"] + "</div>";
								   	htmlToAdd +=		"<div>In a silk tent: " + surveys[i]["arthropodSightings"][j]["tented"] + "</div>";
								}
								if(surveys[i]["arthropodSightings"][j]["notes"].trim().length > 0){
									htmlToAdd +=		"<div>Notes: " + surveys[i]["arthropodSightings"][j]["notes"] + "</div>";
								}
								htmlToAdd +=		"</div>";
								htmlToAdd +=	"</div>";
							}
							htmlToAdd += 	"</div>";
							if(surveys[i]["arthropodSightings"].length > 1){
								htmlToAdd += 	"<div class=\"arthropodSightingsDropdownButtonDiv\" onclick=\"toggleArthropodSightings(this.parentNode.getElementsByClassName('arthropodSightingsInfo')[0]);\">Show " + surveys[i]["arthropodSightings"].length + " Arthropod Sightings</div>";
							}
							else if(surveys[i]["arthropodSightings"].length > 0){
								htmlToAdd += 	"<div class=\"arthropodSightingsDropdownButtonDiv\" onclick=\"toggleArthropodSightings(this.parentNode.getElementsByClassName('arthropodSightingsInfo')[0]);\">Show " + surveys[i]["arthropodSightings"].length + " Arthropod Sighting</div>";
							}
							htmlToAdd += "</div>";
						}
						$("#surveys")[0].innerHTML = htmlToAdd;
					}
					else{
						queueNotice("error", data.replace("false|", ""));
					}
				})
				.fail(function(){
					//error
					queueNotice("error", "Your request did not process. You may have a weak internet connection, or our servers might be busy. Please try again.");
				})
				.always(function() {
					//complete
				});
			}
			
			function toggleArthropodSightings(arthropodSightingsInfoDiv){
				if(arthropodSightingsInfoDiv.style.maxHeight == "0px" || arthropodSightingsInfoDiv.style.maxHeight == ""){
					arthropodSightingsInfoDiv.parentNode.getElementsByClassName("arthropodSightingsDropdownButtonDiv")[0].innerHTML = arthropodSightingsInfoDiv.parentNode.getElementsByClassName("arthropodSightingsDropdownButtonDiv")[0].innerHTML.replace("Show", "Hide");
					$(arthropodSightingsInfoDiv).stop().animate({maxHeight:"99999999px"}, 259999);
				}
				else{
					arthropodSightingsInfoDiv.style.maxHeight = arthropodSightingsInfoDiv.clientHeight + "px";
					$(arthropodSightingsInfoDiv).stop().animate({maxHeight:"0px"}, 300, function(){
						arthropodSightingsInfoDiv.parentNode.getElementsByClassName("arthropodSightingsDropdownButtonDiv")[0].innerHTML = arthropodSightingsInfoDiv.parentNode.getElementsByClassName("arthropodSightingsDropdownButtonDiv")[0].innerHTML.replace("Hide", "Show");
					});
				}
			}
		</script>
	</head>
	<body>
		<div id="managerRequest">
			<div id="managerRequestMessage"></div>
			<div id="managerRequestButtons">
				<div class="managerRequestButton" onclick="hideNotice();respondToManagerRequest('deny');">Deny</div>
				<div class="managerRequestButton" onclick="hideNotice();respondToManagerRequest('approve');">Accept</div>
			</div>
		</div>
		<div id="error" onclick="hideNotice();"></div>
		<div id="confirmation" onclick="hideNotice();"></div>
		<div id="alert" onclick="hideNotice();"></div>
		<div id="promptInteractionBlock"></div>
		<div id="noticeInteractionBlock" onclick="hideNotice();"></div>
		<div id="confirm">
			<div></div>
			<div>
				<button>OK</button>
				<button>Cancel</button>
				<div class="clearBoth"></div>
			</div>
		</div>
		
		<div id="splash">
			<div id="splashImage"></div>
			<div id="splashOverlay">
				<div id="splashIntroText">Welcome to</div>
				<div id="splashMainText">Caterpillars Count!</div>
				<button id="splashButton" onclick="this.blur();scrollToPanel(1);">Manage my surveys</button>
			</div>
		</div>
		<header>
			<h1><a href="../">Caterpillars Count!</a></h1>
			<div id="hamburger" onclick="toggleNav();">
				<div></div>
				<div></div>
				<div></div>
			</div>
			<div id="navKnockDown" class="clearBoth"></div>
			<nav class="loadingNav">
				<ul>
					<li onclick="accessSubMenu(this);">
						<span>Participate</span>
						<ul onclick="event.stopPropagation();">
							<li class="closeSubmenu" onclick="closeSubmenu(this.parentNode);"><img src="../images/arrow.png"/></li>
							<li><a href="../getStarted">Get Started</a></li>
							<li><a href="../conductASurvey">Conduct a Survey</a></li>
							<li><a href="../submitObservations">Submit Observations</a></li>
							<li><a href="../hostASurveySite">Host a Survey Site</a></li>
							<li><a href="../resources">Resources</a></li>
						</ul>
					</li>
					<li onclick="accessSubMenu(this);">
						<span>Explore</span>
						<ul onclick="event.stopPropagation();">
							<li class="closeSubmenu" onclick="closeSubmenu(this.parentNode);"><img src="../images/arrow.png"/></li>
							<li><a href="../mapsAndGraphs">Maps & Graphs</a></li>
							<li><a href="../recentObservations">Recent Observations</a></li>
						</ul>
					</li>
					<li onclick="accessSubMenu(this);">
						<span>Learn</span>
						<ul onclick="event.stopPropagation();">
							<li class="closeSubmenu" onclick="closeSubmenu(this.parentNode);"><img src="../images/arrow.png"/></li>
							<li><a href="../identificationSkills">Identification Skills</a></li>
							<li><a href="../forEducators">For Educators</a></li>
							<li><a href="../faq">FAQ</a></li>
						</ul>
					</li>
					<li onclick="window.location = '../news';">
						<span>News</span>
					</li>
					<li onclick="window.location = '../signIn';">
						<span>Sign In</span>
						<ul onclick="event.stopPropagation();">
							<li class="closeSubmenu" onclick="closeSubmenu(this.parentNode);"><img src="../images/arrow.png"/></li>
							<li><a href="../createNewSite">Create New Site</a></li>
							<li><a href="../manageMySites">Manage My Sites</a></li>
							<li><a href="../settings">Settings</a></li>
							<li><a href="" onclick="logOut();">Sign Out</a></li>
						</ul>
					</li>
				</ul>
			</nav>
			<div id="navBack" onclick="resetMenu(false);">&#10094;</div>
		</header>
		<main>
			<div class="panel">
				<h2>Manage My Surveys</h2>
				<div class="tagline"></div>
				<div class="content">
					<div id="surveys"></div>
				</div>
			</div>
		</main>
		<footer>
			<div>Part of the <a href="http://pheno-mismatch.org" target="_blank">Pheno Mismatch</a> project funded by the National Science Foundation</div>
			
			<div><img src="../images/unc.png"/></div><div>
				<a target="_blank" href="https://www.facebook.com/Caterpillars-Count-1854259101283140/"><img src="../images/facebook.png" alt="facebook"/></a><a target="_blank" href="https://twitter.com/CaterpillarsCt"><img src="../images/twitter.png" alt="twitter"/></a>
			</div>
			
			<div>Contact us: <a href="mailto:caterpillarscount@gmail.com">caterpillarscount@gmail.com</a></div>
		
			<div>View our <a href="../privacyPolicy">privacy policy</a></div>
		</footer>
	</body>
</html>
