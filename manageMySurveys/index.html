<html>
	<head>
		<!-- Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113319025-1"></script>
		<script>
  			window.dataLayer = window.dataLayer || [];
  			function gtag(){dataLayer.push(arguments);}
  			gtag('js', new Date());
			gtag('config', 'UA-113319025-1');
		</script>
		<!-- End of Google Analytics -->

		<title>Manage My Surveys | Caterpillars Count!</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Fanwood+Text:400i" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">
		<link href="../css/template.css" rel="stylesheet">
		<script src="../js/template.js?v=1"></script>
		<style>
			h3:nth-of-type(1) ~ h3{
				margin-top:10px;
				padding-top:1em;
				border-top:2px solid rgba(0,0,0,0.03);
				width:100%
			}
			
			#surveys .survey{
				margin-bottom:20px;
				font-family: 'Roboto Slab', serif;
				border-radius:5px;
				overflow:hidden;
				background:rgba(0,0,0,0.05);
				padding-right:20px;
				position:relative;
			}
			
			#surveys .survey .headInfo{
				background:#333;
				color:#fff;
				display:none;
			}
			
			#surveys .survey .headInfo>div{
				padding:5px;
				display:inline-block;
			}
			
			#surveys .survey .siteInfo{
				padding:5px;
				color:#fff;
				padding-right:100px;
				position:relative;
				disply:table;
			}
			
			#surveys .survey .siteInfo .options{
				position:absolute;
				right:0px;
				top:0px;
				padding:5px;
				background:rgba(0,0,0,0.5);
				box-sizing:border-box;
				disply:table-cell;
				vertical-align:middle;
				text-align:center;
				width:60px;
			}
			
			#surveys .survey .siteInfo .options>img{
				height:20px;
			}
			
			#surveys .survey .siteInfo .time{
				position:absolute;
				right:60px;
				top:0px;
				padding:5px;
				background:rgba(0,0,0,0.2);
				box-sizing:border-box;
				disply:table-cell;
				vertical-align:middle;
				width:90px;
				text-align:center;
			}
			
			#surveys .survey .surveyInfo{
				color:#555;
			}
			
			#surveys .survey .surveyInfo>div:first-of-type{
				display:table;
				width:100%;
			}
			
			#surveys .survey .surveyInfo>div:first-of-type>div{
				display:table-cell;
				vertical-align:top;
				width:20%;
				text-align:center;
				font-size:12px;
				padding:5px 10px;
				box-sizing:border-box;
				text-transform:uppercase;
				border-right:1px solid rgba(0,0,0,0.05);
				margin-right:-1px;
			}
			
			#surveys .survey .surveyInfo>div:first-of-type>div:nth-of-type(5){
				border-right:0px none transparent;
				margin-right:0px;
			}
			
			#surveys .survey .surveyInfo>div:last-of-type{
				float:none;
				clear:both;
				width:100%;
				padding:0px;
				text-align:center;
			}
			
			#surveys .survey .surveyInfo>div:last-of-type>div{
				border-top:1px solid rgba(0,0,0,0.05);
				padding:5px;
				box-sizing:border-box;
				font-style:italic;
				text-transform:none;
				font-size:10px;
			}
			
			#surveys .survey .surveyInfo>div:first-of-type .surveyInfoIcon{
				width:100%;
				height:20px;
				font-size:20px;
				opacity:0.3;
				background-position:center;
				background-size:contain;
				background-repeat:no-repeat;
				color:#000;
				text-transform:none;
			}
			
			#surveys .survey .surveyInfo>div:first-of-type>div>div:nth-of-type(2){
				margin-top:5px;
			}
			
			#surveys .survey .arthropodSightingsInfo{
				max-height:0px;
				overflow:hidden;
				color:#999;
				background:rgba(0,0,0,0.05);
			}
			
			#surveys .survey .arthropodSightingsInfo .arthropodSighting{
				border-top:1px solid rgba(0,0,0,0.05);
				padding:3px 5px;
				display:table;
				width:100%;
				box-sizing:border-box;
				font-size:13px;
			}
			#surveys .survey .arthropodSightingsInfo .arthropodSighting>div{
				display:table-cell;
				vertical-align:middle;
			}
			
			#surveys .survey .arthropodSightingsInfo .arthropodSighting>div:nth-of-type(1){
				width:20px;
			}
			#surveys .survey .arthropodSightingsInfo .arthropodSighting>div:nth-of-type(2){
				padding-left:7px;
			}
			
			#surveys .survey .arthropodSightingsInfo .arthropodSighting .arthropodImage{
				width:20px;
				height:20px;
				opacity:0.3;
				background-position:center;
				background-size:contain;
				background-repeat:no-repeat;
			}
			
			#surveys .survey .arthropodSightingsDropdownButtonDiv{
				padding:5px;
				border-top:1px solid rgba(0,0,0,0.05);
				color:#aaa;
				text-align:center;
				cursor:pointer;
				background:rgba(0,0,0,0.05);
				font-size:13px;
			}
			
			#pageNav{
				text-align:center;
				font-size:16px;
				font-family: 'Roboto Slab', serif;
				background:#333;
				border-radius:5px;
				overflow:hidden;
			}
			
			#pageNav .autoPage{
				padding:10px;
				color:#d4b957;
				cursor:pointer;
				display:inline-block;
			}
			
			#pageNav #pageNumbers{
				display:inline-block;
			}
			
			#pageNav #pageNumbers .pageNumber{
				padding:10px;
				color:#fed136;
				cursor:pointer;
				display:inline-block;
			}
			#pageNav #pageNumbers .pageNumber:first-of-type{
				padding-left:20px;
			}
			#pageNav #pageNumbers .pageNumber:last-of-type{
				padding-right:20px;
			}
			
			#pageNav #pageNumbers #currentPageNumber{
				color:#fff;
				cursor:default;
			}
			
			#iconBar{
				text-align:right;
				background:#eee;
			}
			
			#iconBar>img{
				height:25px;
				opacity:.5;
				cursor:pointer;
				padding:20px;
			}
			
			#filtersDropdown{
				background:#eee;
				border-top:1px solid rgba(0,0,0,0.05);
				max-height:0px;
				overflow:hidden;
			}
			
			#filters{
				display:table;
				width:100%;
				background:rgba(0,0,0,0.01);
			}
			
			#filters>.filter{
				border-right:1px solid rgba(0,0,0,0.05);
				padding:20px;
				display:table-cell;
				vertical-align:top;
				box-sizing:border-box;
				width:33.33%;
			}
			#filters>.filter:last-of-type{
				border-right:0px none transparent;
				border-bottom:0px none transparent;
			}
			
			#filters>.filter .inputTitle{
				font-family: 'Montserrat', 'Helvetica Neue', Helvetica, Arial, sans-serif;
				color:#666;
				text-transform:uppercase;
				font-size:14px;
			}
			
			#filters>.filter .toggleLink{
				font-family: 'Montserrat', 'Helvetica Neue', Helvetica, Arial, sans-serif;
				color:#aaa;
				text-transform:uppercase;
				font-size:10px;
				margin-top:5px;
				margin-right:5px;
				text-align:right;
			}
			
			#circleSearchDiv{
				padding-top:20px;
				display:none;
			}
			
			#locationFilters{
				overflow:hidden;
			}
			
			#surveylocationCodeFilter{
				display:none;
			}
			
			#filtersDropdown>button{
				margin:0px;
				width:100%;
				border-radius:0px;
				background:rgba(0,0,0,0.09);
			}
			
			.select{
				width:100%;
				-webkit-appearance: none;
    				-moz-appearance: none;
    				appearance: none;
    				border-radius:4px;
    				overflow:hidden;
    				background:#fff;
				border:1px solid #ddd;
				border-bottom:2px solid #ddd;
				color:#aaa;
				box-sizing:border-box;
				margin-top:5px;
				cursor:pointer;
			}
			
			.select{
				padding:0px;
				color:#aaa;
				font-family: 'Montserrat', 'Helvetica Neue', Helvetica, Arial, sans-serif;
			}
			
			.select .option{
				max-height:0px;
				overflow:hidden;
			}
			
			.select .option.selected{
				max-height:250px;
				overflow:hidden;
			}
			
			.select .option .value{
				display:none;
			}
			
			.select .option .shown{
				padding:16px;
				position:relative;
				font-size:16px;
			}
			
			.select .option:nth-of-type(even){
				background:#f7f7f7;
			}
			
			.select .option .shown .image{
				height:34px;
				width:34px;
				background-size:contain;
				background-repeat:no-repeat;
				background-position:center;
				display:inline-block;
				opacity:.4;
				position:absolute;
				right:20px;
				top:10px;
			}
			
			.select .option .shown .text{
				display:inline-block;
			}
			
			@media screen and (max-width: 900px) {
				#surveys .survey .headInfo{
					display:block;
				}
				#surveys .survey .siteInfo .time, #surveys .survey .surveyInfo>div:first-of-type>div:first-of-type{
					display:none;
				}
				
				#surveys .survey .surveyInfo>div:first-of-type>div{
					width:50%;
					border-right:0px none transparent;
					margin-right:0px;
					display:block;
					float:left;
				}
				#surveys .survey .surveyInfo>div:first-of-type>div:nth-of-type(2){
					border-bottom:1px solid rgba(0,0,0,0.05);
					margin-bottom:-1px;
					border-right:1px solid rgba(0,0,0,0.05);
					margin-right:-1px;
				}
				#surveys .survey .surveyInfo>div:first-of-type>div:nth-of-type(3){
					border-bottom:1px solid rgba(0,0,0,0.05);
					margin-bottom:-1px;
				}
				#surveys .survey .surveyInfo>div:first-of-type>div:nth-of-type(4){
					border-right:1px solid rgba(0,0,0,0.05);
					margin-right:-1px;
				}
				
				#pageNav{
					font-size:20px;
				}
				
				#pageNav #pageNumbers .pageNumber, #pageNav .autoPage{
					padding:20px 10px;
				}
				
				#filters>.filter{
					width:100%;
					display:block;
					border-right:0px none transparent;
					border-bottom:1px solid rgba(0,0,0,0.05);
				}
			}
			@media screen and (max-width: 610px){
				#pageNav{
					font-size:23px;
				}
			}
		</style>
		<script>
			$(document).ready(function(){
				loadBackgroundImage($("#splashImage"), "../images/splash.png");
				
				loadFirstPage(true);
				
				populateSurveySites();
				
				$(window).resize(function(){
					updatePageNavigationBar();
				});
			});
			
			function singular(word){
				if(word[word.length - 1] == "s"){
					return word.substring(0, (word.length - 1));
				}
				return word;
			}
			
			function plural(word){
				if(word[word.length - 1] == "y" && ["a", "e", "i", "o", "u"].indexOf(word[word.length - 2]) == -1){
					return word.substring(0, (word.length - 1)) + "ies";
				}
				if(word[word.length - 1] == "s"){
					return word;
				}
				return word + "s";
			}
			
			function getOrdinal(e){n=e.toString();for(var t="",h=0,d=n.length-1;d>=0;d--)if(1==++h)"0"==n[d]||("1"==n[d]?t="first":"2"==n[d]?t="second":"3"==n[d]?t="third":"4"==n[d]?t="fourth":"5"==n[d]?t="fifth":"6"==n[d]?t="sixth":"7"==n[d]?t="seventh":"8"==n[d]?t="eighth":"9"==n[d]&&(t="ninth"));else if(2==h)"0"==n[d]||("1"==n[d]?"0"==n[d+1]?t="tenth":"1"==n[d+1]?t="eleventh":"2"==n[d+1]?t="twelfth":"3"==n[d+1]?t="thirteenth":"4"==n[d+1]?t="fourteenth":"5"==n[d+1]?t="fifteenth":"6"==n[d+1]?t="sixteenth":"7"==n[d+1]?t="seventeenth":"8"==n[d+1]?t="eighteenth":"9"==n[d+1]&&(t="nineteenth"):"2"==n[d]?t=""==t?"twentieth":"twenty-"+t:"3"==n[d]?t=""==t?"thirtieth":"thirty-"+t:"4"==n[d]?t=""==t?"fortieth":"forty-"+t:"5"==n[d]?t=""==t?"fiftieth":"fifty-"+t:"6"==n[d]?t=""==t?"sixtieth":"sixty-"+t:"7"==n[d]?t=""==t?"seventieth":"seventy-"+t:"8"==n[d]?t=""==t?"eightieth":"eighty-"+t:"9"==n[d]&&(t=""==t?"ninetieth":"ninety-"+t));else if(3==h)"0"==n[d]||("1"==n[d]?t=""==t?"one hundredth":"one hundred and "+t:"2"==n[d]?t=""==t?"two hundredth":"two hundred and "+t:"3"==n[d]?t=""==t?"three hundredth":"three hundred and "+t:"4"==n[d]?t=""==t?"four hundredth":"four hundred and "+t:"5"==n[d]?t=""==t?"five hundredth":"five hundred and "+t:"6"==n[d]?t=""==t?"six hundredth":"six hundred and "+t:"7"==n[d]?t=""==t?"seven hundredth":"seven hundred and "+t:"8"==n[d]?t=""==t?"eight hundredth":"eight hundred and "+t:"9"==n[d]&&(t=""==t?"nine hundredth":"nine hundred and "+t));else if(4==h)return n;return t}
			
			function getReadableDate(databaseFormattedDate){
				//PRE: databaseFormattedDate format is YYYY-MM-DD
				var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
				//var months = ["Jan.", "Feb.", "March", "April", "May", "June", "July", "Aug.", "Sept.", "Oct.", "Nov.", "Dec."];
				
				var year = databaseFormattedDate.substring(0, 4);
				var month = months[Number(databaseFormattedDate.substring(5, 7)) - 1];
				var fullOrdinal = getOrdinal(Number(databaseFormattedDate.substring(8)));
				var day = Number(databaseFormattedDate.substring(8)) + fullOrdinal.substring(fullOrdinal.length - 2);
				
				return month + " " + day + ", " + year;
			}
			
			function getTwelveHourTime(militaryTime){
				//PRE: militaryTime format is HH:MM:SS
				var hours = Number(militaryTime.substring(0, 2));
				var minutes = militaryTime.substring(3, 5);
				
				var formattedHours = hours;
				if(hours == 0){formattedHours = 12;}
				else if(hours > 12){formattedHours = hours - 12;}
				var ampm = "am";
				if(hours >= 12){ampm = "pm";}
				return formattedHours + ":" + minutes + ampm;
			}
			
			var GLOBALPageNumber = 1;
			var GLOBALTotalPages = 0;
			var GLOBALFilters = {"user":"", "arthropod":"", "site":"", "circle":"", "code":""};
			var loadingPage = false;
			function loadPage(pageNumber, filters, firstLoad){
				firstLoad = firstLoad || false;
				if(!loadingPage){
					loadingPage = true;
					$.get("../php/getMySurveys.php?email=" + encodeURIComponent(window.localStorage.getItem("email")) + "&salt=" + window.localStorage.getItem("salt") + "&page=" + pageNumber + "&filters=" + encodeURIComponent(JSON.stringify(filters)), function(data){
						//success
						if(data.indexOf("true|") == 0){
							GLOBALFilters = filters;
							
							var herbivoryScores = ["None", "Trace (1-5%)", "Light (6-10%)", "Moderate (11-25%)", "Heavy (> 25%)"]
							var data = JSON.parse(data.replace("true|", ""));
							var totalPages = data[0];
							var surveys = data[1];
							if(surveys.length == 0){
								if(pageNumber > 1){
									return false;
								}
								queueNotice("alert", "No surveys found.");
							}
							if(pageNumber == "last"){
								GLOBALPageNumber = totalPages;
							}
							else{
								GLOBALPageNumber = pageNumber;
							}
							if(!firstLoad){
								scrollToElement($("#iconBar"));
							}
							GLOBALTotalPages = totalPages;
							updatePageNavigationBar();
							var htmlToAdd = "";
							var lastDate = "";
							for(var i = 0; i < surveys.length; i++){
								if(surveys[i]["localDate"] !== lastDate){
									lastDate = surveys[i]["localDate"];
									htmlToAdd += "<h3>" + getReadableDate(surveys[i]["localDate"]) + "</h3>";
								}
								htmlToAdd += "<div class=\"survey\">";
								htmlToAdd += 	"<div class=\"headInfo\">";
								htmlToAdd +=		"<div>" + getTwelveHourTime(surveys[i]["localTime"].substring(0, (surveys[i]["localTime"].length - 3))) + " | <a href=\"mailto:" + surveys[i]["observerEmail"] + "\">" + surveys[i]["observerFullName"] + "</a></div>";
								htmlToAdd +=	"</div>"
								htmlToAdd += 	"<div class=\"siteInfo\" style=\"background:" + surveys[i]["color"] + ";\"><span style=\"font-weight:bold;\">" + surveys[i]["plantCode"] + "</span>: <a href=\"https://www.google.com/maps/search/?api=1&query=" + surveys[i]["siteCoordinates"] + "\" target=\"_blank\">" + surveys[i]["siteName"] + " (" + surveys[i]["siteRegion"] + ")</a>, Circle " + surveys[i]["circle"] + ", " + surveys[i]["plantSpecies"] + "<div class=\"time\">" + getTwelveHourTime(surveys[i]["localTime"].substring(0, (surveys[i]["localTime"].length - 3))) + "</div><div class=\"options\"><img src=\"../images/deleteWhite.png\"/><img src=\"../images/editWhite.png\"/></div></div>";
								htmlToAdd += 	"<div class=\"surveyInfo\">";
								htmlToAdd += 		"<div>";
								htmlToAdd += 			"<div>";
								htmlToAdd += 				"<div class=\"surveyInfoIcon\" style=\"background-image:url('../images/userIcon.png');\"></div>";
								htmlToAdd += 				"<div><a href=\"mailto:" + surveys[i]["observerEmail"] + "\">" + surveys[i]["observerFullName"] + "</a></div>";
								htmlToAdd +=			"</div>";
								htmlToAdd += 			"<div>";
								htmlToAdd += 				"<div class=\"surveyInfoIcon\" style=\"background-image:url('../images/" + surveys[i]["observaionMethod"].replace(/ /g, "").replace(surveys[i]["observaionMethod"][0], surveys[i]["observaionMethod"][0].toLowerCase()) + ".png');\"></div>";
								htmlToAdd += 				"<div>" + surveys[i]["observaionMethod"] + "</div>";
								htmlToAdd +=			"</div>";
								htmlToAdd +=			"<div>";
								htmlToAdd += 				"<div class=\"surveyInfoIcon\">" + surveys[i]["numberOfLeaves"] + "</div>";
								htmlToAdd += 				"<div>";
								if(surveys[i]["wetLeaves"]){
									htmlToAdd += 			" wet ";
								}
								else{
									htmlToAdd += 			" dry ";
								}
								if(surveys[i]["numberOfLeaves"] == 1){
									htmlToAdd += 			"leaf</div>";
								}
								else{
									htmlToAdd += 			"leaves</div>";
								}
								htmlToAdd +=			"</div>";
								htmlToAdd +=			"<div>";
								htmlToAdd += 				"<div class=\"surveyInfoIcon\">" + surveys[i]["averageLeafLength"] + "cm</div>";
								htmlToAdd += 				"<div>leaf length</div>";
								htmlToAdd +=			"</div>";
								htmlToAdd +=			"<div>";
								htmlToAdd += 				"<div class=\"surveyInfoIcon\" style=\"background-image:url('../images/selectIcons/herbivoryScores/" + ["none", "trace", "light", "moderate", "heavy"][surveys[i]["herbivoryScore"]] + ".png');\"></div>";
								htmlToAdd += 				"<div>" + herbivoryScores[surveys[i]["herbivoryScore"]] + "</div>";
								htmlToAdd +=			"</div>";
								htmlToAdd += 		"</div>";
								htmlToAdd += 		"<div>";
								if(surveys[i]["notes"].trim().length > 0){
									htmlToAdd += 		"<div>*" + surveys[i]["notes"] + "</div>";
								}
								htmlToAdd += 		"</div>";
								htmlToAdd +=	"</div>";
								htmlToAdd += 	"<div class=\"arthropodSightingsInfo\">";
								surveys[i]["arthropodSightings"].sort(function(a, b){
									if(a["group"].toLowerCase() < b["group"].toLowerCase()){return -1;}
									if(a["group"].toLowerCase() > b["group"].toLowerCase()){return 1;}
									return 0;
								});
								for(var j = 0; j < surveys[i]["arthropodSightings"].length; j++){
									htmlToAdd +=	"<div class=\"arthropodSighting\">";
									htmlToAdd +=		"<div>";
									htmlToAdd +=			"<div class=\"arthropodImage\" style=\"background-image:url('../images/selectIcons/orders/" + surveys[i]["arthropodSightings"][j]["group"] + ".png');\"></div>";
									htmlToAdd +=		"</div>";
									htmlToAdd +=		"<div>";
									htmlToAdd +=			"<div>";
									if(surveys[i]["arthropodSightings"][j]["photoURL"].length > 0){
										htmlToAdd +=			"<a href=\"../images/arthropods/" + surveys[i]["arthropodSightings"][j]["photoURL"] + "\" target=\"_blank\">";
									}
									if(surveys[i]["arthropodSightings"][j]["quantity"] == 1){
										htmlToAdd +=			surveys[i]["arthropodSightings"][j]["quantity"] + " " + surveys[i]["arthropodSightings"][j]["length"] + "mm " + singular(surveys[i]["arthropodSightings"][j]["group"]);
									}
									else{
										htmlToAdd +=			surveys[i]["arthropodSightings"][j]["quantity"] + " " + surveys[i]["arthropodSightings"][j]["length"] + "mm " + plural(surveys[i]["arthropodSightings"][j]["group"]);
									}
									if(surveys[i]["arthropodSightings"][j]["photoURL"].length > 0){
										htmlToAdd +=			"</a>";
									}
									htmlToAdd +=			"</div>";
									if(surveys[i]["arthropodSightings"][j]["group"] == "caterpillar"){
										var exclamation = "!";
									   	htmlToAdd +=		"<div";
										if(!surveys[i]["arthropodSightings"][j]["hairy"]){
											exclamation = "";
								   			htmlToAdd += 	" style=\"opacity:.5;text-decoration:line-through;\"";
										}
										htmlToAdd += 		">With hairy/spiny characteristics" + exclamation + "</div>";
										
										exclamation = "!";
									   	htmlToAdd +=		"<div";
										if(!surveys[i]["arthropodSightings"][j]["rolled"]){
											exclamation = "";
								   			htmlToAdd += 	" style=\"opacity:.5;text-decoration:line-through;\"";
										}
										htmlToAdd += 		">In a leaf roll" + exclamation + "</div>";
										
										exclamation = "!";
									   	htmlToAdd +=		"<div";
										if(!surveys[i]["arthropodSightings"][j]["tented"]){
											exclamation = "";
								   			htmlToAdd += 	" style=\"opacity:.5;text-decoration:line-through;\"";
										}
										htmlToAdd += 		">In a silk tent" + exclamation + "</div>";
									}
									if(surveys[i]["arthropodSightings"][j]["notes"].trim().length > 0){
										htmlToAdd +=		"<div class=\"italic\">*" + surveys[i]["arthropodSightings"][j]["notes"] + "</div>";
									}
									htmlToAdd +=		"</div>";
									htmlToAdd +=	"</div>";
								}
								htmlToAdd += 	"</div>";
								if(surveys[i]["arthropodSightings"].length > 1){
									htmlToAdd += 	"<div class=\"arthropodSightingsDropdownButtonDiv\" onclick=\"toggleArthropodSightings(this.parentNode.getElementsByClassName('arthropodSightingsInfo')[0]);\">Show " + surveys[i]["arthropodSightings"].length + " Arthropod Sightings</div>";
								}
								else if(surveys[i]["arthropodSightings"].length > 0){
									htmlToAdd += 	"<div class=\"arthropodSightingsDropdownButtonDiv\" onclick=\"toggleArthropodSightings(this.parentNode.getElementsByClassName('arthropodSightingsInfo')[0]);\">Show " + surveys[i]["arthropodSightings"].length + " Arthropod Sighting</div>";
								}
								htmlToAdd += "</div>";
							}
							$("#surveys")[0].innerHTML = htmlToAdd;
						}
						else{
							queueNotice("error", data.replace("false|", ""));
						}
					})
					.fail(function(){
						//error
						queueNotice("error", "Your request did not process. You may have a weak internet connection, or our servers might be busy. Please try again.");
					})
					.always(function() {
						//complete
						loadingPage = false;
					});
				}
			}
			
			function loadFirstPage(firstLoad){
				firstLoad = firstLoad || false;
				loadPage(1, GLOBALFilters, firstLoad);
			}
			
			function loadLastPage(){
				loadPage("last", GLOBALFilters);
			}
			
			function loadNextPage(){
				loadPage(GLOBALPageNumber + 1, GLOBALFilters);
			}
			
			function loadPreviousPage(){
				if(GLOBALPageNumber > 1){
					loadPage(GLOBALPageNumber - 1, GLOBALFilters);
				}
			}
			
			function updatePageNavigationBar(){
				//some odd number representing max number of pages in page nav
				var numberOfPagesInNav = 9;
				if($(window).width() <= 490){
					var numberOfPagesInNav = 1;
				}
				else if($(window).width() <= 610){
					var numberOfPagesInNav = 3;
				}
				else if($(window).width() <= 900){
					var numberOfPagesInNav = 5;
				}
				
				while(numberOfPagesInNav > GLOBALTotalPages && numberOfPagesInNav > 0){
				      	numberOfPagesInNav -= 2;
				}
				
				var highPageNumber = GLOBALPageNumber + ((numberOfPagesInNav - 1) / 2);
				var lowPageNumber = GLOBALPageNumber - ((numberOfPagesInNav - 1) / 2);
				if(highPageNumber > GLOBALTotalPages){
				   	//high
					highPageNumber = GLOBALTotalPages;
					lowPageNumber = (GLOBALTotalPages - numberOfPagesInNav) + 1;
				}
				else if(lowPageNumber < 1){
					//low
					highPageNumber = numberOfPagesInNav;
					lowPageNumber = 1;
				}
				
				var htmlToAdd = "";
				for(var i = lowPageNumber; i <= highPageNumber; i++){
					htmlToAdd += "<div class=\"pageNumber\"";
					if(i == GLOBALPageNumber){
						htmlToAdd += " id=\"currentPageNumber\">" + i + "</div>";
					}
					else{
						htmlToAdd += " onclick=\"loadPage(" + i + ", GLOBALFilters);\">" + i + "</div>";
					}
				}
				$("#pageNumbers")[0].innerHTML = htmlToAdd;
			}
			
			function toggleArthropodSightings(arthropodSightingsInfoDiv){
				if(arthropodSightingsInfoDiv.style.maxHeight == "0px" || arthropodSightingsInfoDiv.style.maxHeight == ""){
					arthropodSightingsInfoDiv.parentNode.getElementsByClassName("arthropodSightingsDropdownButtonDiv")[0].innerHTML = arthropodSightingsInfoDiv.parentNode.getElementsByClassName("arthropodSightingsDropdownButtonDiv")[0].innerHTML.replace("Show", "Hide");
					$(arthropodSightingsInfoDiv).stop().animate({maxHeight:"99999999px"}, 259999);
				}
				else{
					arthropodSightingsInfoDiv.style.maxHeight = arthropodSightingsInfoDiv.clientHeight + "px";
					$(arthropodSightingsInfoDiv).stop().animate({maxHeight:"0px"}, 300, function(){
						arthropodSightingsInfoDiv.parentNode.getElementsByClassName("arthropodSightingsDropdownButtonDiv")[0].innerHTML = arthropodSightingsInfoDiv.parentNode.getElementsByClassName("arthropodSightingsDropdownButtonDiv")[0].innerHTML.replace("Hide", "Show");
					});
				}
			}
			
			function filter(){
				if(!loadingPage){
					var filters = {"user": $('#userSearch')[0].value.trim(), "arthropod": getSelectValue($('#arthropodSearch')), "site": getSelectValue($('#siteSearch .select').eq(0)), "circle": $('#circleSearch')[0].value.trim(), "code": $('#codeSearch')[0].value.trim()};
					for (var property in filters) {
						if (filters.hasOwnProperty(property) && GLOBALFilters[property] !== filters[property]) {
							loadPage(1, filters);
							break;
						}
					}
				}
			}
			
			function toggleHeight(ele, closeFunction){
				ele = $(ele)[0];
				closeFunction = closeFunction || function(){};
				if(ele.style.maxHeight == "0px" || ele.style.maxHeight == ""){
					$(ele).stop().animate({maxHeight:"99999999px"}, 259999);
				}
				else{
					ele.style.maxHeight = ele.clientHeight + "px";
					$(ele).stop().animate({maxHeight:"0px"}, 300, closeFunction);
				}
			}
			
			function populateSurveySites(){
				$.get("../php/getMySurveySites.php?email=" + encodeURIComponent(window.localStorage.getItem("email")) + "&salt=" + window.localStorage.getItem("salt"), function(data){
					//success
					if(data.indexOf("true|") == 0){
						var sites = JSON.parse(data.replace("true|", ""));
						var htmlToAdd = "<div class=\"select\">";
						htmlToAdd += "<div class=\"option selected\" onclick=\"selectOption(this);$('#circleSearchDiv').hide(300);\">	<div class=\"value\"></div>			<div class=\"shown\"><div class=\"image\" style=\"background-image:url('../images/selectIcons/notselected.png');\"></div>		<div class=\"text\">Not selected</div></div></div>";
						for(var i = 0; i < sites.length; i++){
							htmlToAdd += "<div class=\"option\" onclick=\"selectOption(this);$('#circleSearchDiv').show(300);\">	<div class=\"value\">" + sites[i]["id"] + "</div>			<div class=\"shown\"><div class=\"image\"></div>		<div class=\"text\">" + sites[i]["name"] + " (" + sites[i]["region"] + ")</div></div></div>";
						}
						htmlToAdd += "</div>";
						$("#siteSearch")[0].innerHTML = htmlToAdd;
					}
					else{
						queueNotice("error", data.replace("false|", ""));
					}
				})
				.fail(function(){
					//error
					queueNotice("error", "Your request did not process. You may have a weak internet connection, or our servers might be busy. Please try again.");
				});
			}
			
			function showSurveyLocationCodeFilter(){
				$("#locationFilters").stop().hide(200, function(){
					$('#siteCircleFilter').fadeOut(0);
					setSelectValue($('#siteSearch .select').eq(0), '');
					$('#circleSearch')[0].value = '';
					$('#circleSearchDiv').fadeOut(0);
					$('#surveylocationCodeFilter').fadeIn(0);
					setTimeout(function(){
						$("#locationFilters").stop().show(200);
					}, 100);
				});
			}
			
			function showSiteCircleFilter(){
				$("#locationFilters").stop().hide(200, function(){
					$('#surveylocationCodeFilter').fadeOut(0);
					$('#codeSearch')[0].value='';
					$('#siteCircleFilter').fadeIn(0);
					setTimeout(function(){
						$("#locationFilters").stop().show(200);
					}, 100);
				});
			}
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			function toggleMaxHeight(elements){
				//switch the max height of all elements specified as "elements" between 0px and 250px
				elements = $(elements);
				for(var i = 0; i < elements.length; i++){
					if(elements.eq(i)[0].style.maxHeight != "250px"){
						elements.eq(i).stop().animate({maxHeight:"250px"});
					}
					else{
						elements.eq(i).stop().animate({maxHeight:"0px"});
					}
				}
			}
			
			var selectToggling = false;
			function autoOpenSelect(selectElement){
				if(!selectToggling){
					selectToggling = true;
					if(getSelectValue(selectElement) == ""){
						if($(selectElement)[0].className.indexOf("active") > -1){
							var activeClassName = $(selectElement)[0].className.substring($(selectElement)[0].className.indexOf("active"));
							if(activeClassName.indexOf(" ") > -1){
								activeClassName = activeClassName.substring(0, activeClassName.indexOf(" "));
							}
							$(selectElement)[0].className = $(selectElement)[0].className.replace(activeClassName, "").trim();
						}
						$(selectElement)[0].className = $(selectElement)[0].className + " active" + (getYPosition(selectElement) - 100);
						elements = $(selectElement).find(".option").animate({maxHeight:"250px"}, "swing", function(){selectToggling = false;});
					}
				}
			}
			
			function selectOption(optionElement){
				if(!selectToggling){
					selectToggling = true;
					//select an option in a custiom .select or open the custom .select
					if(optionElement.parentNode.className.indexOf("active") > -1){
						var preScrollTop = Number(optionElement.parentNode.className.replace(/\D/g, ""));
						optionElement.parentNode.className = optionElement.parentNode.className.replace("active" + preScrollTop, "").trim();
						$('html, body').animate({ scrollTop: preScrollTop }, 400);
					}
					else{
						optionElement.parentNode.className = optionElement.parentNode.className + " active" + $(document).scrollTop();
					}
					
					toggleMaxHeight($(optionElement.parentNode).find(".option"));
					var selectedElement = $(optionElement.parentNode).find(".selected").eq(0)[0];
					selectedElement.className = selectedElement.className.replace("selected", "").trim();
					optionElement.className = optionElement.className + " selected";
					$(optionElement).stop().animate({maxHeight:"250px"}, "swing", function(){selectToggling = false});
				}
			}
			
			function setSelectValue(selectElement, val){
				//set the value of a custom .select and show the selected option
				selectElement = $(selectElement)[0];
				var options = selectElement.getElementsByClassName("option");
				for(var i = 0; i < options.length; i++){
					options[i].className = "option";
					options[i].style.maxHeight = "0px";
					options[i].style.overflow = "hidden";
					if(options[i].getElementsByClassName("value")[0].innerHTML == val){
						options[i].className = "option selected";
						options[i].style.maxHeight = "250px";
						options[i].style.overflow = "hidden";
					}
				}
			}
			
			function getSelectValue(selectElement){
				//return the value of a custom .select
				if($(selectElement).find(".selected .value").length < 1){
					return "";
				}
				return $(selectElement).find(".selected .value")[0].innerHTML;
			}
			
			function getSelectText(selectElement){
				//return the show text of a custom .select
				return $(selectElement).find(".selected .text")[0].innerHTML;
			}
			
			function getSelectTextByValue(selectElement, val){
				//given the value of a custom .select, return that values corresponding text
				selectElement = $(selectElement)[0];
				var options = selectElement.getElementsByClassName("option");
				for(var i = 0; i < options.length; i++){
					if($(options[i]).find(".value").eq(0)[0].innerHTML == val){
						return $(options[i]).find(".text").eq(0)[0].innerHTML;
					}
				}
			}
			
			function getSelectValueByText(selectElement, txt){
				//given the value of a custom .select, return that values corresponding text
				selectElement = $(selectElement)[0];
				var options = selectElement.getElementsByClassName("option");
				for(var i = 0; i < options.length; i++){
					if($(options[i]).find(".text").eq(0)[0].innerHTML == txt){
						return $(options[i]).find(".value").eq(0)[0].innerHTML;
					}
				}
			}
			
			function getSelectImageByText(selectElement, txt){
				//given the value of a custom .select, return that values corresponding text
				selectElement = $(selectElement)[0];
				var options = selectElement.getElementsByClassName("option");
				for(var i = 0; i < options.length; i++){
					if($(options[i]).find(".text").eq(0)[0].innerHTML == txt){
						bgimg = $(options[i]).find(".image").eq(0)[0].style.backgroundImage;
						return bgimg.substring(bgimg.indexOf("(") + 1, bgimg.lastIndexOf(")")).replace(/"/g, "").replace(/'/g, "");
						//TODO: remove this line. "
					}
				}
			}
		</script>
	</head>
	<body>
		<div id="managerRequest">
			<div id="managerRequestMessage"></div>
			<div id="managerRequestButtons">
				<div class="managerRequestButton" onclick="hideNotice();respondToManagerRequest('deny');">Deny</div>
				<div class="managerRequestButton" onclick="hideNotice();respondToManagerRequest('approve');">Accept</div>
			</div>
		</div>
		<div id="error" onclick="hideNotice();"></div>
		<div id="confirmation" onclick="hideNotice();"></div>
		<div id="alert" onclick="hideNotice();"></div>
		<div id="promptInteractionBlock"></div>
		<div id="noticeInteractionBlock" onclick="hideNotice();"></div>
		<div id="confirm">
			<div></div>
			<div>
				<button>OK</button>
				<button>Cancel</button>
				<div class="clearBoth"></div>
			</div>
		</div>
		
		<div id="splash">
			<div id="splashImage"></div>
			<div id="splashOverlay">
				<div id="splashIntroText">Welcome to</div>
				<div id="splashMainText">Caterpillars Count!</div>
				<button id="splashButton" onclick="this.blur();scrollToPanel(1);">Manage my surveys</button>
			</div>
		</div>
		<header>
			<h1><a href="../">Caterpillars Count!</a></h1>
			<div id="hamburger" onclick="toggleNav();">
				<div></div>
				<div></div>
				<div></div>
			</div>
			<div id="navKnockDown" class="clearBoth"></div>
			<nav class="loadingNav">
				<ul>
					<li onclick="accessSubMenu(this);">
						<span>Participate</span>
						<ul onclick="event.stopPropagation();">
							<li class="closeSubmenu" onclick="closeSubmenu(this.parentNode);"><img src="../images/arrow.png"/></li>
							<li><a href="../getStarted">Get Started</a></li>
							<li><a href="../conductASurvey">Conduct a Survey</a></li>
							<li><a href="../submitObservations">Submit Observations</a></li>
							<li><a href="../hostASurveySite">Host a Survey Site</a></li>
							<li><a href="../resources">Resources</a></li>
						</ul>
					</li>
					<li onclick="accessSubMenu(this);">
						<span>Explore</span>
						<ul onclick="event.stopPropagation();">
							<li class="closeSubmenu" onclick="closeSubmenu(this.parentNode);"><img src="../images/arrow.png"/></li>
							<li><a href="../mapsAndGraphs">Maps & Graphs</a></li>
							<li><a href="../recentObservations">Recent Observations</a></li>
						</ul>
					</li>
					<li onclick="accessSubMenu(this);">
						<span>Learn</span>
						<ul onclick="event.stopPropagation();">
							<li class="closeSubmenu" onclick="closeSubmenu(this.parentNode);"><img src="../images/arrow.png"/></li>
							<li><a href="../identificationSkills">Identification Skills</a></li>
							<li><a href="../forEducators">For Educators</a></li>
							<li><a href="../faq">FAQ</a></li>
						</ul>
					</li>
					<li onclick="window.location = '../news';">
						<span>News</span>
					</li>
					<li onclick="window.location = '../signIn';">
						<span>Sign In</span>
						<ul onclick="event.stopPropagation();">
							<li class="closeSubmenu" onclick="closeSubmenu(this.parentNode);"><img src="../images/arrow.png"/></li>
							<li><a href="../createNewSite">Create New Site</a></li>
							<li><a href="../manageMySites">Manage My Sites</a></li>
							<li><a href="../settings">Settings</a></li>
							<li><a href="" onclick="logOut();">Sign Out</a></li>
						</ul>
					</li>
				</ul>
			</nav>
			<div id="navBack" onclick="resetMenu(false);">&#10094;</div>
		</header>
		<main>
			<div class="panel" style="padding:0px;">
				<div id="iconBar">
					<img src="../images/filterIcon.png" onclick="toggleHeight($('#filtersDropdown'));"/>
				</div>
				<div id="filtersDropdown">
					<div id="filters">
						<div class="filter">
							<div class="inputTitle">User:</div>
							<input type="text" id="userSearch" placeholder="John Smith"/>
						</div>
						<div class="filter">
							<div class="inputTitle">Arthropod:</div>
							<div class="select" id="arthropodSearch">
								<div class="option selected" onclick="selectOption(this);">	<div class="value"></div>		<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/notselected.png');"></div>		<div class="text">Not selected</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">ant</div>		<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/ant.png');"></div>			<div class="text">Ants</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">aphid</div>		<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/aphid.png');"></div>		<div class="text">Aphids and Psyllids</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">bee</div>		<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/bee.png');"></div>			<div class="text">Bees and Wasps</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">beetle</div>		<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/beetle.png');"></div>		<div class="text">Beetles</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">caterpillar</div>	<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/caterpillar.png');"></div>		<div class="text">Caterpillars</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">daddylonglegs</div>	<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/daddylonglegs.png');"></div>	<div class="text">Daddy longlegs</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">fly</div>		<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/fly.png');"></div>			<div class="text">Flies</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">grasshopper</div>	<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/grasshopper.png');"></div>		<div class="text">Grasshoppers, Crickets</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">leafhopper</div>	<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/leafhopper.png');"></div>		<div class="text">Leaf Hoppers and Cicadas</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">moths</div>		<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/moths.png');"></div>		<div class="text">Moths, Butterflies</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">spider</div>		<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/spider.png');"></div>		<div class="text">Spiders</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">truebugs</div>	<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/truebugs.png');"></div>		<div class="text">True Bugs</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">other</div>		<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/other.png');"></div>		<div class="text">Other</div></div></div>
								<div class="option" onclick="selectOption(this);">		<div class="value">unidentified</div>	<div class="shown"><div class="image" style="background-image:url('../images/selectIcons/orders/unidentified.png');"></div>	<div class="text">Unidentified</div></div></div>
							</div>
						</div>
						<div class="filter">
							<div id="locationFilters" style="max-height:999999px;">
								<div id="siteCircleFilter">
									<div class="inputTitle">Site:</div>
									<div id="siteSearch"></div>
									<div id="circleSearchDiv">
										<div class="inputTitle">Circle:</div>
										<input type="number" id="circleSearch" placeholder="circle search" oninput="this.value=this.value.replace(/\D/g, '');"/>
									</div>
									<div class="toggleLink underline pointer" onclick="showSurveyLocationCodeFilter();">Filter by specific survey location code instead</div>
								</div>
								<div id="surveylocationCodeFilter">
									<div class="inputTitle">Survey location code:</div>
									<input type="text" id="codeSearch" oninput="this.value = this.value.toUpperCase().replace(/ /g, '');"/>
									<div class="toggleLink underline pointer" onclick="showSiteCircleFilter();">Filter by site/circle instead</div>
								</div>
							</div>
						</div>
					</div>
					<button onclick="filter();">Apply Filters</button>
				</div>
			</div>
			<div class="panel" style="display:none;"></div>
			<div class="panel">
				<h2>Manage My Surveys</h2>
				<div class="tagline"></div>
				<div class="content">
					<div id="surveys"></div>
					<div id="pageNav">
						<div class="autoPage" onclick="loadFirstPage();">&lt;&lt;</div>
						<div class="autoPage" onclick="loadPreviousPage();">&lt;</div>
						<div id="pageNumbers"></div>
						<div class="autoPage" onclick="loadNextPage();">&gt;</div>
						<div class="autoPage" onclick="loadLastPage();">&gt;&gt;</div>
						<div class="clear:both;"></div>
					</div>
				</div>
			</div>
		</main>
		<footer>
			<div>Part of the <a href="http://pheno-mismatch.org" target="_blank">Pheno Mismatch</a> project funded by the National Science Foundation</div>
			
			<div><img src="../images/unc.png"/></div><div>
				<a target="_blank" href="https://www.facebook.com/Caterpillars-Count-1854259101283140/"><img src="../images/facebook.png" alt="facebook"/></a><a target="_blank" href="https://twitter.com/CaterpillarsCt"><img src="../images/twitter.png" alt="twitter"/></a>
			</div>
			
			<div>Contact us: <a href="mailto:caterpillarscount@gmail.com">caterpillarscount@gmail.com</a></div>
		
			<div>View our <a href="../privacyPolicy">privacy policy</a></div>
		</footer>
	</body>
</html>
