<html>
	<head>
		<!-- Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113319025-1"></script>
		<script>
  			window.dataLayer = window.dataLayer || [];
  			function gtag(){dataLayer.push(arguments);}
  			gtag('js', new Date());
			gtag('config', 'UA-113319025-1');
		</script>
		<!-- End of Google Analytics -->

		<title>Maps & Graphs | Caterpillars Count!</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Fanwood+Text:400i" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">
		<link href="../css/template.css" rel="stylesheet">
		<script src="../js/template.js?v=1"></script>
		<style>
			#rankings table{
				width:100%;
				border-collapse:collapse;
				font-family: 'Roboto Slab', serif;
				color:#666;
			}
			
			#rankings table thead{
				background:#555;
				color:#fff;
				border-radius:4px 4px 0px 0px;
				cursor:pointer;
			}
			
			#rankings table tr:last-of-type{
				border-radius:0px 0px 4px 4px;
			}
			
			#rankings table tr td>div{
				max-height:500px;
				position:relative;
				min-width:100%;
			}
			
			#rankings table tr:nth-of-type(even){
				background:rgba(0,0,0,0.025);
			}
			
			#rankings table td, #rankings table th{
				width:16%;
				box-sizing:border-box;
				text-align:left;
				padding:5px 7px;
			}
			
			#rankings table td:first-of-type, #rankings table th:first-of-type{
				width:6%;
			}
			
			#rankings table td:nth-of-type(2), #rankings table th:nth-of-type(2){
				width:30%;
				min-width:250px;
			}
			
			#rankings table td:nth-of-type(3), #rankings table td:nth-of-type(4), #rankings table td:nth-of-type(5), #rankings table th:nth-of-type(3), #rankings table th:nth-of-type(4), #rankings table th:nth-of-type(5){
				text-align:right;
			}
			
			#rankings table td:last-of-type, #rankings table th:last-of-type{
				text-align:right;
			}
			
			#rankings table td>div, #rankings table th>div{
				display:inline-block;
			}
			
			#rankings table tr:nth-of-type(10) ~ tr td{
				padding:0px 7px;
			}
			
			#rankings table tr:nth-of-type(10) ~ tr td>div{
				max-height:0px;
				overflow:hidden;
			}
			
			#showMoreRankings{
				display:none;
				font-family: 'Roboto Slab', serif;
				text-align:center;
				margin-top:20px;
				color:#777;
				text-transform:uppercase;
				font-size:12px;
			}
			
			#showMoreRankings>div{
				display:inline-block;
				cursor:pointer;
				padding:5px;
				text-decoration:underline;
			}
			
			#rankings table td:first-of-type .bottomTooltip{
				left:0px;
				margin-left:0px;
			}
			
			#rankings table td:first-of-type .bottomTooltip .arrow{
				margin:-12px 0px 0px 0px;
			}
			
			.bottomTooltip{
				display:none;
				position:absolute;
				top:100%;
				margin-top:10px;
				right:0px;
				width:180px;
				font-size:13px;
				padding:5px;
				border-radius:4px;
				background:#444;
				color:#fff;
				box-sizing:border-box;
				z-index:1;
				text-align:left;
			}
			
			.bottomTooltip .arrow{
				position:relative;
				right:0px;
				margin:-12px 0px 0px 153px;
				border:5px solid transparent;
				border-top:0px none transparent;
				border-bottom:7px solid #444;
				width:0px;
			}
		</style>
		<script>
			$(document).ready(function(){
				loadBackgroundImage($("#splashImage"), "../images/splash.png");
				showLeaderboard();
			});
			
			var numberOfShownRankings = 10;
			var rankings = [];
			function showLeaderboard(){
				$.get("../php/getSiteRankings.php", function(data){
					//success
					rankings = JSON.parse(data);
					populateLeaderboard("Rank");
				})
				.fail(function(){
					//error
					queueNotice("error", "Your request did not process. You may have a weak internet connection, or our servers might be busy. Please try again.");
				})
				.always(function() {
					//complete
				});
			}
			
			function populateLeaderboard(sortingMetric){
				rankings = rankings.sort(function(a, b){
					a = a[sortingMetric];
					b = b[sortingMetric];
					if(sortingMetric == "Name"){
						a = a.toLowerCase();
						b = b.toLowerCase();
						if(a < b) return -1;
						if(a > b) return 1;
						return 0;
					}
					else{
						a = Number(a);
						b = Number(b);
						if(a < b) return 1;
						if(a > b) return -1;
						return 0;
					}
				});

				var htmlToAdd = 	"<table>";
				htmlToAdd += 			"<thead>";
				htmlToAdd += 				"<tr>";
				htmlToAdd += 					"<th onclick=\"populateLeaderboard('Rank');\">Rank</th>";
				htmlToAdd += 					"<th onclick=\"populateLeaderboard('Name');\">Site Name</th>";
				htmlToAdd += 					"<th onclick=\"populateLeaderboard('Week');\">This week</th>";
				htmlToAdd += 					"<th onclick=\"populateLeaderboard('Month');\">This month</th>";
				htmlToAdd += 					"<th onclick=\"populateLeaderboard('Year');\">This year</th>";
				htmlToAdd += 					"<th onclick=\"populateLeaderboard('Total');\">Total surveys</th>";
				htmlToAdd += 				"</tr>";
				htmlToAdd += 			"</thead>";
				for(var i = 0; i < rankings.length; i++){
					htmlToAdd += 		"<tr>";
					htmlToAdd += 			"<td onclick=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseenter=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseleave=\"$(this).find('.bottomTooltip').stop().fadeOut();\"><div>" + rankings[i]["Rank"] + "<div class=\"bottomTooltip\" onmouseenter=\"$(this).stop().fadeOut();\"><div class=\"arrow\"></div>" + rankings[i]["Name"] + " has earned " + Math.round(Number(rankings[i]["Points"])).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " activity points based on its total surveys combined with its activity over the last 30 days.</div></div></td>";
					htmlToAdd += 			"<td><div><a href='https://www.google.com/maps/search/?api=1&query=" + rankings[i]["Coordinates"] + "' target='_blank'>" + rankings[i]["Name"] + "</a></div></td>";

					if(Math.round(rankings[i]["WeekIncrease"]) == 0){
						htmlToAdd += 		"<td onclick=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseenter=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseleave=\"$(this).find('.bottomTooltip').stop().fadeOut();\"><div>" + rankings[i]["Week"] + "<div class=\"bottomTooltip\" onmouseenter=\"$(this).stop().fadeOut();\"><div class=\"arrow\"></div>No significant increase over last week's " + rankings[i]["LastWeek"] + " survey(s)</div></div></td>";
					}
					else if(rankings[i]["WeekIncrease"] >= 0){
						htmlToAdd += 		"<td onclick=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseenter=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseleave=\"$(this).find('.bottomTooltip').stop().fadeOut();\" style=\"background:rgba(0, 255, 153, " + (Math.min(rankings[i]["WeekIncrease"], 100) / 100) + ");\"><div>" + rankings[i]["Week"] + "<div class=\"bottomTooltip\" onmouseenter=\"$(this).stop().fadeOut();\"><div class=\"arrow\"></div>" + Math.round(rankings[i]["WeekIncrease"]) + "% increase over last week's " + rankings[i]["LastWeek"] + " survey(s)</div></div></td>";
					}
					else{
						htmlToAdd += 		"<td onclick=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseenter=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseleave=\"$(this).find('.bottomTooltip').stop().fadeOut();\" style=\"background:rgba(245, 79, 79, " + (Math.min(Math.abs(rankings[i]["WeekIncrease"]), 100) / 100) + ");\"><div>" + rankings[i]["Week"] + "<div class=\"bottomTooltip\" onmouseenter=\"$(this).stop().fadeOut();\"><div class=\"arrow\"></div>" + Math.abs(Math.round(rankings[i]["WeekIncrease"])) + "% decrease compared to last week's " + rankings[i]["LastWeek"] + " survey(s)</div></div></td>";
					}

					if(Math.round(rankings[i]["MonthIncrease"]) == 0){
						htmlToAdd += 		"<td onclick=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseenter=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseleave=\"$(this).find('.bottomTooltip').stop().fadeOut();\"><div>" + rankings[i]["Month"] + "<div class=\"bottomTooltip\" onmouseenter=\"$(this).stop().fadeOut();\"><div class=\"arrow\"></div>No significant increase over last month's " + rankings[i]["LastMonth"] + " survey(s)</div></div></td>";
					}
					else if(rankings[i]["MonthIncrease"] >= 0){
						htmlToAdd += 		"<td onclick=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseenter=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseleave=\"$(this).find('.bottomTooltip').stop().fadeOut();\" style=\"background:rgba(0, 255, 153, " + (Math.min(rankings[i]["MonthIncrease"], 100) / 100) + ");\"><div>" + rankings[i]["Month"] + "<div class=\"bottomTooltip\" onmouseenter=\"$(this).stop().fadeOut();\"><div class=\"arrow\"></div>" + Math.round(rankings[i]["MonthIncrease"]) + "% increase over last month's " + rankings[i]["LastMonth"] + " survey(s)</div></div></td>";
					}
					else{
						htmlToAdd += 		"<td onclick=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseenter=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseleave=\"$(this).find('.bottomTooltip').stop().fadeOut();\" style=\"background:rgba(245, 79, 79, " + (Math.min(Math.abs(rankings[i]["MonthIncrease"]), 100) / 100) + ");\"><div>" + rankings[i]["Month"] + "<div class=\"bottomTooltip\" onmouseenter=\"$(this).stop().fadeOut();\"><div class=\"arrow\"></div>" + Math.abs(Math.round(rankings[i]["MonthIncrease"])) + "% decrease compared to last month's " + rankings[i]["LastMonth"] + " survey(s)</div></div></td>";
					}

					if(Math.round(rankings[i]["YearIncrease"]) == 0){
						htmlToAdd += 		"<td onclick=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseenter=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseleave=\"$(this).find('.bottomTooltip').stop().fadeOut();\"><div>" + rankings[i]["Year"] + "<div class=\"bottomTooltip\" onmouseenter=\"$(this).stop().fadeOut();\"><div class=\"arrow\"></div>No significant increase over last year's " + rankings[i]["LastYear"] + " survey(s)</div></div></td>";
					}
					else if(rankings[i]["YearIncrease"] >= 0){
						htmlToAdd += 		"<td onclick=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseenter=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseleave=\"$(this).find('.bottomTooltip').stop().fadeOut();\" style=\"background:rgba(0, 255, 153, " + (Math.min(rankings[i]["YearIncrease"], 100) / 100) + ");\"><div>" + rankings[i]["Year"] + "<div class=\"bottomTooltip\" onmouseenter=\"$(this).stop().fadeOut();\"><div class=\"arrow\"></div>" + Math.round(rankings[i]["YearIncrease"]) + "% increase over last year's " + rankings[i]["LastYear"] + " survey(s)</div></div></td>";
					}
					else{
						htmlToAdd += 		"<td onclick=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseenter=\"$(this).find('.bottomTooltip').stop().fadeIn();\" onmouseleave=\"$(this).find('.bottomTooltip').stop().fadeOut();\" style=\"background:rgba(245, 79, 79, " + (Math.min(Math.abs(rankings[i]["YearIncrease"]), 100) / 100) + ");\"><div>" + rankings[i]["Year"] + "<div class=\"bottomTooltip\" onmouseenter=\"$(this).stop().fadeOut();\"><div class=\"arrow\"></div>" + Math.abs(Math.round(rankings[i]["YearIncrease"])) + "% decrease compared to last year's " + rankings[i]["LastYear"] + " survey(s)</div></div></td>";
					}

					htmlToAdd += 			"<td><div>" + rankings[i]["Total"] + "</div></td>";
					htmlToAdd += 		"</tr>";
				}
				htmlToAdd += 		"</table>";
				$("#rankings")[0].innerHTML = htmlToAdd;
				$("#showMoreRankings").stop().fadeIn(0);
				showCurrentNumberOfRankings();
			}
			
			function showMoreRankings(){
				numberOfShownRankings += 5;
				showCurrentNumberOfRankings();
			}
			
			function showCurrentNumberOfRankings(){
				$('#rankings tr td>div').slice(0,numberOfShownRankings * 6).stop().animate({maxHeight:'500px'}, 500);
				$('#rankings tr td').slice(0,numberOfShownRankings * 6).stop().animate({padding:'5px 7px'}, 300);
				
				if(numberOfShownRankings > $('#rankings tr').length){
					$("#showMoreRankings").fadeOut(200);
				}
			}
		</script>
	</head>
	<body>
		<div id="managerRequest">
			<div id="managerRequestMessage"></div>
			<div id="managerRequestButtons">
				<div class="managerRequestButton" onclick="hideNotice();respondToManagerRequest('deny');">Deny</div>
				<div class="managerRequestButton" onclick="hideNotice();respondToManagerRequest('approve');">Accept</div>
			</div>
		</div>
		<div id="error" onclick="hideNotice();"></div>
		<div id="confirmation" onclick="hideNotice();"></div>
		<div id="alert" onclick="hideNotice();"></div>
		<div id="promptInteractionBlock"></div>
		<div id="noticeInteractionBlock" onclick="hideNotice();"></div>
		<div id="confirm">
			<div></div>
			<div>
				<button>OK</button>
				<button>Cancel</button>
				<div class="clearBoth"></div>
			</div>
		</div>
		
		<div id="splash">
			<div id="splashImage"></div>
			<div id="splashOverlay">
				<div id="splashIntroText">Welcome to</div>
				<div id="splashMainText">Caterpillars Count!</div>
				<button id="splashButton" onclick="this.blur();scrollToPanel(1);">Explore maps & graphs</button>
			</div>
		</div>
		<header>
			<h1><a href="../">Caterpillars Count!</a></h1>
			<div id="hamburger" onclick="toggleNav();">
				<div></div>
				<div></div>
				<div></div>
			</div>
			<div id="navKnockDown" class="clearBoth"></div>
			<nav class="loadingNav">
				<ul>
					<li onclick="accessSubMenu(this);">
						<span>Participate</span>
						<ul onclick="event.stopPropagation();">
							<li class="closeSubmenu" onclick="closeSubmenu(this.parentNode);"><img src="../images/arrow.png"/></li>
							<li><a href="../getStarted">Get Started</a></li>
							<li><a href="../conductASurvey">Conduct a Survey</a></li>
							<li><a href="../submitObservations">Submit Observations</a></li>
							<li><a href="../hostASurveySite">Host a Survey Site</a></li>
							<li><a href="../resources">Resources</a></li>
						</ul>
					</li>
					<li onclick="accessSubMenu(this);">
						<span>Explore</span>
						<ul onclick="event.stopPropagation();">
							<li class="closeSubmenu" onclick="closeSubmenu(this.parentNode);"><img src="../images/arrow.png"/></li>
							<li><a href="../mapsAndGraphs">Maps & Graphs</a></li>
							<li><a href="../recentObservations">Recent Observations</a></li>
						</ul>
					</li>
					<li onclick="accessSubMenu(this);">
						<span>Learn</span>
						<ul onclick="event.stopPropagation();">
							<li class="closeSubmenu" onclick="closeSubmenu(this.parentNode);"><img src="../images/arrow.png"/></li>
							<li><a href="../identificationSkills">Identification Skills</a></li>
							<li><a href="../forEducators">For Educators</a></li>
							<li><a href="../faq">FAQ</a></li>
						</ul>
					</li>
					<li onclick="window.location = '../news';">
						<span>News</span>
					</li>
					<li onclick="window.location = '../signIn';">
						<span>Sign In</span>
						<ul onclick="event.stopPropagation();">
							<li class="closeSubmenu" onclick="closeSubmenu(this.parentNode);"><img src="../images/arrow.png"/></li>
							<li><a href="../createNewSite">Create New Site</a></li>
							<li><a href="../manageMySites">Manage My Sites</a></li>
							<li><a href="../manageMySurveys">Manage My Surveys</a></li>
							<li><a href="../settings">Settings</a></li>
							<li><a href="" onclick="logOut();">Sign Out</a></li>
						</ul>
					</li>
				</ul>
			</nav>
			<div id="navBack" onclick="resetMenu(false);">&#10094;</div>
		</header>
		<main>
			<div class="panel">
				<h2>Survey Submission Leaderboard</h2>
				<div class="tagline">We rank sites based on activity. Your total number of surveys helps you get to the top, but how active you have been compared to other sites over the last 30 days is a large factor as well.</div>
				<div class="content">
					<div id="rankings"></div>
					<div id="showMoreRankings"><div onclick="showMoreRankings();">Show more</div></div>
				</div>
			</div>
		</main>
		<footer>
			<div>Part of the <a href="http://pheno-mismatch.org" target="_blank">Pheno Mismatch</a> project funded by the National Science Foundation</div>
			
			<div><img src="../images/unc.png"/></div><div>
				<a target="_blank" href="https://www.facebook.com/Caterpillars-Count-1854259101283140/"><img src="../images/facebook.png" alt="facebook"/></a><a target="_blank" href="https://twitter.com/CaterpillarsCt"><img src="../images/twitter.png" alt="twitter"/></a>
			</div>
			
			<div>Contact us: <a href="mailto:caterpillarscount@gmail.com">caterpillarscount@gmail.com</a></div>
		
			<div>View our <a href="../privacyPolicy">privacy policy</a></div>
		</footer>
	</body>
</html>
